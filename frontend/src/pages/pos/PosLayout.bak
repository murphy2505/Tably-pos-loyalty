import { Outlet, NavLink } from "react-router-dom";
import { useEffect, useState } from "react";
import {
  fetchPosBootstrap,
  type PosBootstrap,
} from "../../services/posBootstrap";

export default function PosLayout() {
  const [data, setData] = useState<PosBootstrap | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [menuOpen, setMenuOpen] = useState(false);

  useEffect(() => {
    (async () => {
      try {
        const bootstrap = await fetchPosBootstrap();
        setData(bootstrap);
      } catch (e: any) {
        setError(e.message || "Fout bij laden POS data");
      } finally {
        setLoading(false);
      }
    })();
  }, []);

  if (loading) return <div>POS laden…</div>;
  if (error) return <div>Fout: {error}</div>;
  if (!data) return <div>Geen POS data</div>;

  return (
    <div className="pos-shell">
      {/* Bovenbalk met hamburger */}
      <header className="pos-header">
        <button
          className="pos-menu-btn"
          type="button"
          onClick={() => setMenuOpen((v) => !v)}
        >
          ☰
        </button>
        <h1>POS</h1>
      </header>

      {/* Zijmenu - altijd in DOM, class 'open' regelt slide-in */}
      <nav className={`pos-sidebar ${menuOpen ? "open" : ""}`}>
        <div className="pos-menu-section">
          <div className="pos-menu-title">Kassa</div>
          <NavLink to="/pos/kassa">Kassa</NavLink>
        </div>

        <div className="pos-menu-section">
          <div className="pos-menu-title">Assortiment</div>
          <NavLink to="/pos/products">Producten</NavLink>
          <NavLink to="/pos/categories">Categorieën</NavLink>
          <NavLink to="/pos/stock">Voorraad</NavLink>
        </div>

        <div className="pos-menu-section">
          <div className="pos-menu-title">Rapportage</div>
          <NavLink to="/pos/reports">Overzicht</NavLink>
        </div>

        <div className="pos-menu-section">
          <div className="pos-menu-title">Operatie</div>
          <NavLink to="/pos/tables">Tafels</NavLink>
          <NavLink to="/pos/kds">KDS</NavLink>
          <NavLink to="/pos/planning">Planning</NavLink>
        </div>
      </nav>

      {/* Overlay – sluit menu bij klik */}
      {menuOpen && (
        <div
          className="pos-sidebar-overlay"
          onClick={() => setMenuOpen(false)}
        />
      )}

      {/* Content + bootstrap data via Outlet context */}
      <main className="pos-content">
        <Outlet context={data} />
      </main>
    </div>
  );
}
